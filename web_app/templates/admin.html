{% extends "base.html" %}
{% block title %}Admin Paneli Â· GÃ¶rev Formu Sistemi{% endblock %}

{% block content %}
<h2>ğŸ› ï¸ Admin Paneli</h2>
<p>Buradan aÃ§Ä±lÄ±r menÃ¼lerde kullanÄ±lan verileri dÃ¼zenleyebilir veya yeni bir JSON dosyasÄ± yÃ¼kleyebilirsiniz.</p>

<section class="form-card">
    <h3>Listeleri DÃ¼zenle</h3>
    <form method="post" action="{{ url_for('admin_update') }}" class="stacked">
        <label for="default_dok_no">VarsayÄ±lan DÃ¶kÃ¼man No</label>
        <input id="default_dok_no" name="default_dok_no" type="text" value="{{ form_defaults.dok_no }}" required>

        <label for="default_rev_no">VarsayÄ±lan Revizyon</label>
        <input id="default_rev_no" name="default_rev_no" type="text" value="{{ form_defaults.rev_no }}" placeholder="00 / 06.05.24" required>

        <p class="helper-text">GÃ¶rev atama yetkilileri ve Ã§alÄ±ÅŸan listeleri artÄ±k aÅŸaÄŸÄ±daki tablolardan yÃ¶netilmektedir.</p>

        <label for="taseron_options">TaÅŸeron Åirketler</label>
        <textarea id="taseron_options" name="taseron_options" rows="6">{{ data.taseron_options | join('\n') }}</textarea>

        <label for="arac_plaka_options">AraÃ§ Plaka Listesi</label>
        <textarea id="arac_plaka_options" name="arac_plaka_options" rows="6">{{ data.arac_plaka_options | join('\n') }}</textarea>

        <button type="submit" class="button save">ğŸ’¾ DeÄŸiÅŸiklikleri Kaydet</button>
    </form>
</section>

<section class="form-card">
    <h3>ğŸ‘‘ Admin KullanÄ±cÄ±larÄ±</h3>
    <div class="user-management">
        <table class="user-table">
            <thead>
                <tr>
                    <th>Ad Soyad</th>
                    <th>E-posta</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for user in admin_users %}
                <tr>
                    <td>{{ user.full_name }}</td>
                    <td>{{ user.email or '-' }}</td>
                    <td>
                        <form method="post" action="{{ url_for('admin_delete_user', user_id=user.id) }}">
                            <button type="submit" class="button danger small">Sil</button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="3" class="empty">KayÄ±tlÄ± admin bulunmuyor.</td></tr>
                {% endfor %}
            </tbody>
        </table>
        <form method="post" action="{{ url_for('admin_create_user', role='admin') }}" class="stacked user-create">
            <h4>Yeni Admin Ekle</h4>
            <label for="admin_full_name">Ad Soyad</label>
            <input id="admin_full_name" name="full_name" type="text" required>
            <label for="admin_email">E-posta</label>
            <input id="admin_email" name="email" type="email" required>
            <label for="admin_password">Åifre (min 8 karakter)</label>
            <input id="admin_password" name="password" type="password" minlength="8" required>
            <button type="submit" class="button save">Admin Ekle</button>
        </form>
    </div>
</section>

<section class="form-card">
    <h3>ğŸ§‘â€ğŸ’¼ GÃ¶rev Atama Yetkilileri</h3>
    <div class="user-management">
        <table class="user-table">
            <thead>
                <tr>
                    <th>Ad Soyad</th>
                    <th>E-posta</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for user in assign_users %}
                <tr>
                    <td>{{ user.full_name }}</td>
                    <td>{{ user.email or '-' }}</td>
                    <td>
                        <form method="post" action="{{ url_for('admin_delete_user', user_id=user.id) }}">
                            <button type="submit" class="button danger small">Sil</button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="3" class="empty">KayÄ±tlÄ± gÃ¶rev atama yetkilisi bulunmuyor.</td></tr>
                {% endfor %}
            </tbody>
        </table>
        <form method="post" action="{{ url_for('admin_create_user', role='atayan') }}" class="stacked user-create">
            <h4>Yeni Yetkili Ekle</h4>
            <label for="assign_full_name">Ad Soyad</label>
            <input id="assign_full_name" name="full_name" type="text" required>
            <label for="assign_email">E-posta</label>
            <input id="assign_email" name="email" type="email" required>
            <label for="assign_password">Åifre (min 8 karakter)</label>
            <input id="assign_password" name="password" type="password" minlength="8" required>
            <button type="submit" class="button save">Yetkili Ekle</button>
        </form>
    </div>
</section>

<section class="form-card">
    <h3>ğŸ‘· Ã‡alÄ±ÅŸanlar</h3>
    <div class="user-management">
        <table class="user-table">
            <thead>
                <tr>
                    <th>Ad Soyad</th>
                    <th>E-posta</th>
                    <th>Telefon</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for user in employee_users %}
                <tr>
                    <td>{{ user.full_name }}</td>
                    <td>{{ user.email or '-' }}</td>
                    <td>{{ user.phone or '-' }}</td>
                    <td>
                        <form method="post" action="{{ url_for('admin_delete_user', user_id=user.id) }}">
                            <button type="submit" class="button danger small">Sil</button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="4" class="empty">KayÄ±tlÄ± Ã§alÄ±ÅŸan bulunmuyor.</td></tr>
                {% endfor %}
            </tbody>
        </table>
        <form method="post" action="{{ url_for('admin_create_user', role='calisan') }}" class="stacked user-create">
            <h4>Yeni Ã‡alÄ±ÅŸan Ekle</h4>
            <label for="employee_full_name">Ad Soyad</label>
            <input id="employee_full_name" name="full_name" type="text" required>
            <label for="employee_email">E-posta (opsiyonel)</label>
            <input id="employee_email" name="email" type="email">
            <label for="employee_phone">Telefon (opsiyonel)</label>
            <input id="employee_phone" name="phone" type="text">
            <button type="submit" class="button save">Ã‡alÄ±ÅŸan Ekle</button>
        </form>
    </div>
</section>

<section class="form-card">
    <h3>JSON DosyasÄ± YÃ¼kle</h3>
    <p>"taseron_options" ve "arac_plaka_options" anahtarlarÄ±nÄ± iÃ§eren bir JSON dosyasÄ± yÃ¼kleyerek bu listeleri toplu olarak gÃ¼ncelleyebilirsiniz. Ã‡alÄ±ÅŸan ve gÃ¶rev atama yetkilisi listeleri kullanÄ±cÄ± tablolarÄ±ndan yÃ¶netilir.</p>
    <form method="post" action="{{ url_for('admin_upload') }}" enctype="multipart/form-data" class="stacked">
        <input type="file" name="data_file" accept="application/json" required>
        <button type="submit" class="button secondary">ğŸ“ DosyayÄ± YÃ¼kle</button>
    </form>
</section>

<a class="button" href="{{ url_for('logout') }}">Ã‡Ä±kÄ±ÅŸ Yap</a>
{% endblock %}
